<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9445622961277646"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCF-Online</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        /* 您提供的所有CSS样式都完整保留在这里 */
        /* 全局样式 */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-top: 20px;
            padding-bottom: 20px;
            background-color: #f8f9fa;
            transition: background-color 0.3s ease;
        }
        
        /* 页面标题 */
        .page-title {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .page-title h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
            transition: color 0.3s ease;
        }
        
        .page-title p {
            font-size: 1.1rem;
            color: #6c757d;
            transition: color 0.3s ease;
        }
        
        /* 主容器 */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        /* 按钮容器 */
        .button-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        /* 按钮样式 */
        .custom-btn {
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }
        
        .reset-btn {
            background-color: #e0e0e0;
            color: #333;
        }
        
        .reset-btn:hover {
            background-color: #d0d0d0;
        }
        
        .dark-mode-btn {
            background-color: #4d4d4d;
            color: #fff;
        }
        
        .dark-mode-btn:hover {
            background-color: #3a3a3a;
        }
        
        /* 更新按钮样式 */
        .update-btn {
            background: linear-gradient(45deg, #007bff, #28a745);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .update-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }
        
        .update-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .update-btn .spinner {
            display: none;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        .update-btn.loading .spinner {
            display: inline-block;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 排序按钮样式 */
        .sortable-header {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: 20px !important;
            transition: background-color 0.3s ease;
        }
        
        .sortable-header:hover {
            background-color: #f8f9fa;
        }
        
        .sort-indicator {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            color: #6c757d;
        }
        
        .sort-indicator.asc::after {
            content: "▲";
            color: #007bff;
        }
        
        .sort-indicator.desc::after {
            content: "▼";
            color: #007bff;
        }
        
        .sort-indicator.none::after {
            content: "⇅";
        }
        
        /* 状态提示 */
        .status-info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 20px;
            display: none;
        }
        
        .status-info.success {
            background: #e8f5e8;
            border-color: #4caf50;
            color: #2e7d32;
        }
        
        .status-info.error {
            background: #ffebee;
            border-color: #f44336;
            color: #c62828;
        }
        
        .status-info.info {
            color: #1565c0;
        }
        
        /* 截稿时间状态颜色 */
        .deadline-urgent {
            color: #dc3545;
            font-weight: bold;
        }
        
        .deadline-warning {
            color: #fd7e14;
            font-weight: bold;
        }
        
        .deadline-normal {
            color: #28a745;
        }
        
        .deadline-passed {
            color: #6c757d;
            text-decoration: line-through;
        }
        
        .deadline-unknown {
            color: #6c757d;
            font-style: italic;
        }
        
        /* 搜索图标 */
        .tab-container {
            margin-bottom: 20px;
        }
        
        .tab-btn {
            padding: 8px 16px;
            background-color: #e9ecef;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            transition: all 0.3s ease;
        }
        
        .tab-btn.active {
            background-color: #0d6efd;
            color: white;
        }
        
        /* 搜索图标 */
        .search-container {
            margin-bottom: 25px;
        }
        
        #search-input {
            padding: 12px 15px;
            border: 1px solid #d1d1e0;
            border-radius: 30px;
            font-size: 16px;
            width: 100%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        #search-input:focus {
            border-color: #5d78ff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(93, 120, 255, 0.25);
        }
        
        /* 筛选器样式 */
        .filter-container,
        .jcr-filter-container,
        .markdown-filter-container {
            margin-bottom: 25px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            background-color: #f9f9f9;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .jcr-filter-container,
        .markdown-filter-container {
            display: none; /* 默认隐藏 */
        }
        
        .filter-group label,
        .jcr-filter-group label,
        .markdown-filter-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: block;
            transition: color 0.3s ease;
        }
        
        .filter-group select,
        .jcr-filter-group select,
        .markdown-filter-group select {
            padding: 10px 15px;
            border: 1px solid #d1d1e0;
            border-radius: 6px;
            font-size: 15px;
            width: 100%;
            background-color: #fff;
            transition: all 0.3s ease;
        }
        
        .filter-group select:focus,
        .jcr-filter-group select:focus,
        .markdown-filter-group select:focus {
            border-color: #5d78ff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(93, 120, 255, 0.25);
        }
        
        /* 表格容器样式 */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            width: 100%;
            display: block;
        }

        /* 表格样式 */
        table.table {
            width: 100%;
            min-width: 1200px;
            color: #333;
            margin-bottom: 0;
            border-collapse: collapse;
        }

        /* 表格单元格样式 */
        table.table th,
        table.table td {
            padding: 12px 10px;
            border-bottom: 1px solid #e0e0e0;
            vertical-align: middle;
            transition: background-color 0.3s ease;
            word-break: break-word;
            white-space: normal;
            box-sizing: border-box;
            font-size: 14px;
        }

        table.table tr:hover {
            background-color: #f5f7ff;
        }
        
        /* 链接样式 */
        table.table td a {
            color: #4d6fff;
            font-weight: 600;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        table.table td a:hover {
            color: #2a49d1;
            text-decoration: underline;
        }
        
        /* 无结果提示 */
        .no-results {
            text-align: center;
            padding: 40px 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            margin-top: 20px;
            transition: background-color 0.3s ease;
        }
        
        .no-results p {
            font-size: 18px;
            color: #6c757d;
            transition: color 0.3s ease;
        }
        
        /* 夜间模式样式 */
        body.dark-mode {
            background-color: #1a1a2e;
        }
        
        body.dark-mode .page-title h1 {
            color: #e0e0e0;
        }
        
        body.dark-mode .page-title p {
            color: #b0b0b0;
        }
        
        body.dark-mode .main-container {
            background-color: #252539;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        body.dark-mode .filter-container,
        body.dark-mode .jcr-filter-container,
        body.dark-mode .markdown-filter-container {
            background-color: #2a2a40;
            border-color: #3a3a50;
        }
        
        body.dark-mode .filter-group label,
        body.dark-mode .jcr-filter-group label,
        body.dark-mode .markdown-filter-group label {
            color: #e0e0e0;
        }
        
        body.dark-mode .filter-group select,
        body.dark-mode .jcr-filter-group select,
        body.dark-mode .markdown-filter-group select {
            background-color: #33334d;
            color: #e0e0e0;
            border-color: #444460;
        }
        
        body.dark-mode .filter-group select:focus,
        body.dark-mode .jcr-filter-group select:focus,
        body.dark-mode .markdown-filter-group select:focus {
            border-color: #5d78ff;
            box-shadow: 0 0 0 3px rgba(93, 120, 255, 0.25);
        }
        
        body.dark-mode table.table {
            color: #e0e0e0;
            background-color: #252539;
        }

        body.dark-mode table.table tbody tr td {
            background-color: #252539 !important;
            color: #e0e0e0 !important;
        }
        
        body.dark-mode table.table th {
            background-color: #2a2a40;
            color: #e0e0e0;
            border-color: #3a3a50;
        }
        
        body.dark-mode table.table td {
            border-color: #3a3a50;
        }
        
        body.dark-mode table.table tr:hover {
            background-color: #2a2a40;
        }
        
        body.dark-mode table.table td a {
            color: #64a0ff;
        }
        
        body.dark-mode table.table td a:hover {
            color: #8ab1ff;
        }
        
        body.dark-mode .no-results {
            background-color: #2a2a40;
        }
        
        body.dark-mode .no-results p {
            color: #b0b0b0;
        }

        body.dark-mode .sortable-header:hover {
            background-color: #3a3a50;
        }

        /* 分页样式 */
        .pagination-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .pagination-btn {
            padding: 4px 8px;
            margin: 0 5px;
            border: 1px solid #d1d1e0;
            border-radius: 5px;
            background-color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination-btn:hover {
            background-color: #f0f0f0;
        }

        .pagination-btn.active {
            background-color: #0d6efd;
            color: white;
            border-color: #0d6efd;
        }

        .pagination-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* 移动端适配 */
        @media (max-width: 768px) {
            .main-container { padding: 15px; }
            .button-container { flex-wrap: wrap; gap: 8px; }
            .custom-btn { padding: 8px 16px; font-size: 14px; }
            .filter-container, .jcr-filter-container, .markdown-filter-container { padding: 15px; }
            table.table th, table.table td { padding: 10px 8px; font-size: 12px; }
            .table-container { margin-top: 15px; border-radius: 6px; overflow-x: auto; width: 100%; }
            thead { display: none; }
            table.table tbody tr { display: block; width: 100%; margin-bottom: 20px; border-radius: 6px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); background-color: #fff; position: relative; overflow: auto; }
            body.dark-mode table.table tbody tr { background-color: #2a2a40; }
            table.table td { display: block; text-align: left; position: relative; padding-left: 7%; max-width: none !important; border-bottom: 1px solid #e0e0e0; word-break: break-word; white-space: normal; box-sizing: border-box; }
            body.dark-mode table.table td { border-color: #3a3a50; }
            table.table td:last-child { border-bottom: none; }
            table.table td::before { content: attr(data-label); position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-weight: bold; text-align: left; width: 25%; color: #666; font-size: 12px; }
            body.dark-mode table.table td::before { color: #b0b0b0; }
            table.table td:last-child a, table.table td[data-label="分享"] button { display: inline-block; padding: 6px 12px; background-color: #5d78ff; color: white !important; border-radius: 4px; text-align: center; min-width: 60px; font-size: 12px; }
            body.dark-mode table.table td:last-child a, body.dark-mode table.table td[data-label="分享"] button { background-color: #4a5dcc; }
            .no-results { padding: 20px; }
            .no-results p { font-size: 16px; }
        }

        /* 样式添加 */
        .share-row-btn {
            padding: 4px 10px;
            font-size: 12px;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .share-row-btn:hover {
            background-color: #0056b3;
        }
        .share-row-btn.copied {
            background-color: #28a745; /* 复制成功后的绿色 */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-title">
            <h1>CCF Online</h1>
            <p>Author: William-Liwei</p>
            <p>Shanghai University</p>
        </div>
        
        <div class="button-container">
            <button class="custom-btn reset-btn" id="reset-btn">清空所有选项</button>
            <button class="custom-btn dark-mode-btn" id="dark-mode-btn">夜间模式</button>
            <button class="custom-btn update-btn" id="update-btn">
                <span class="spinner"></span>
                <span class="btn-text">更新会议数据</span>
            </button>
            <button class="custom-btn" id="share-btn" style="background-color: #17a2b8; color: white;">一键分享</button>
        </div>
        
        <div class="status-info" id="status-info">
            <span id="status-text"></span>
        </div>
        
        <div class="tab-container">
            <button class="tab-btn active" data-tab="ccf">CCF Deadlines</button>
            <button class="tab-btn" data-tab="jcr">JCR 数据</button>
            <button class="tab-btn" data-tab="markdown">CCF推荐列表</button>
        </div>
        
        <div class="search-container">
            <input type="text" id="search-input" class="form-control" placeholder="输入关键词搜索...">
        </div>
        
        <div class="filter-container" id="ccf-filters">
            <div class="row">
                <div class="col-md-3">
                    <div class="filter-group">
                        <label for="category-filter" class="form-label">领域</label>
                        <select id="category-filter" class="form-select">
                            <option value="all">所有领域</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="filter-group">
                        <label for="level-filter" class="form-label">CCF级别</label>
                        <select id="level-filter" class="form-select">
                            <option value="all">所有级别</option>
                            <option value="A">A类</option>
                            <option value="B">B类</option>
                            <option value="C">C类</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="filter-group">
                        <label for="year-filter" class="form-label">年份</label>
                        <select id="year-filter" class="form-select">
                            <option value="all">所有年份</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="filter-group">
                        <label for="deadline-filter" class="form-label">截稿状态</label>
                        <select id="deadline-filter" class="form-select">
                            <option value="all">所有状态</option>
                            <option value="upcoming">即将截稿</option>
                            <option value="open">开放投稿</option>
                            <option value="passed">已截稿</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="jcr-filter-container" id="jcr-filters">
            <div class="row">
                <div class="col-md-3">
                    <div class="jcr-filter-group">
                        <label for="jcr-category-filter">类别</label>
                        <select id="jcr-category-filter" class="form-select">
                            <option value="all">所有类别</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="jcr-filter-group">
                        <label for="jcr-impact-filter">影响因子范围</label>
                        <select id="jcr-impact-filter" class="form-select">
                            <option value="all">所有范围</option>
                            <option value="high">高于 10</option>
                            <option value="medium">5 - 10</option>
                            <option value="low">低于 5</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="jcr-filter-group">
                        <label for="jcr-quartile-filter">JCR分区</label>
                        <select id="jcr-quartile-filter" class="form-select">
                            <option value="all">所有分区</option>
                            <option value="Q1">Q1</option>
                            <option value="Q2">Q2</option>
                            <option value="Q3">Q3</option>
                            <option value="Q4">Q4</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="jcr-filter-group">
                        <label for="jcr-cas-filter">中科院分区</label>
                        <select id="jcr-cas-filter" class="form-select">
                            <option value="all">所有分区</option>
                            <option value="1区">1区</option>
                            <option value="2区">2区</option>
                            <option value="3区">3区</option>
                            <option value="4区">4区</option>
                            <option value="Top">Top期刊</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="filter-container markdown-filter-container" id="markdown-filters" style="display: none;">
            <div class="row">
                <div class="col-md-3">
                    <div class="markdown-filter-group">
                        <label for="markdown-category-filter" class="form-label">领域</label>
                        <select id="markdown-category-filter" class="form-select">
                            <option value="all">所有领域</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="markdown-filter-group">
                        <label for="markdown-type-filter" class="form-label">类型</label>
                        <select id="markdown-type-filter" class="form-select">
                            <option value="all">所有类型</option>
                            <option value="期刊">期刊</option>
                            <option value="会议">会议</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="markdown-filter-group">
                        <label for="markdown-level-filter" class="form-label">级别</label>
                        <select id="markdown-level-filter" class="form-select">
                            <option value="all">所有级别</option>
                            <option value="A">A类</option>
                            <option value="B">B类</option>
                            <option value="C">C类</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="markdown-filter-group">
                        <label for="markdown-publisher-filter" class="form-label">出版社</label>
                        <select id="markdown-publisher-filter" class="form-select">
                            <option value="all">所有出版社</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="table-container">
            <table class="table table-striped" id="data-table">
                <thead id="table-header"></thead>
                <tbody id="table-body"></tbody>
            </table>
            <div class="no-results" id="no-results" style="display: none;">
                <p>没有找到符合条件的数据。</p>
            </div>
        </div>

        <div class="pagination-container" id="pagination-container"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <script>
        let jcrData = [];
        let conferenceData = [];
        let markdownData = [];
        let currentTab = 'ccf';
        let sortState = { column: null, direction: 'none' };
        let acceptanceRateData = {};

        const categoryMap = { 'AI': '人工智能', 'CT': '计算机科学理论', 'CG': '计算机图形学与多媒体', 'DS': '计算机体系结构/并行与分布计算/存储系统', 'NW': '计算机网络', 'SC': '网络与信息安全', 'SE': '软件工程/系统软件/程序设计语言', 'DB': '数据库/数据挖掘/内容检索', 'HI': '人机交互与普适计算', 'MX': '交叉/综合/新兴' };

        // 表头模板修改
        const ccfHeaderTemplate = `<tr><th class="sortable-header" data-column="title">简称 <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="description">全称 <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="sub">领域 <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="ccf_rank">CCF <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="year">年份 <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="deadline">截稿时间 <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="acceptance_rate">录用率 <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="date">会议日期 <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="place">地点 <span class="sort-indicator none"></span></th><th>链接</th><th>分享</th></tr>`;
        const jcrHeaderTemplate = `<tr><th class="sortable-header" data-column="name">期刊名 <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="issn">ISSN <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="category">类别 <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="impactFactor">影响因子 <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="quartile">JCR分区 <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="cas_partition">中科院分区 <span class="sort-indicator none"></span></th><th>分享</th></tr>`;
        const markdownHeaderTemplate = `<tr><th class="sortable-header" data-column="name">简称 <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="totalname">全称 <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="category">领域 <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="type">类型 <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="level">级别 <span class="sort-indicator none"></span></th><th class="sortable-header" data-column="publisher">出版社 <span class="sort-indicator none"></span></th><th>链接</th><th>分享</th></tr>`;

        function showStatus(message, type = 'info') {
            const statusInfo = document.getElementById('status-info');
            const statusText = document.getElementById('status-text');
            if (!statusInfo || !statusText) return;
            statusInfo.className = `status-info ${type}`;
            statusText.textContent = message;
            statusInfo.style.display = 'block';
            if (type !== 'info') setTimeout(() => { statusInfo.style.display = 'none'; }, 5000);
        }

        function getDeadlineStatus(deadline) {
            if (!deadline || deadline === 'TBD') return 'unknown';
            const now = new Date(); const deadlineDate = new Date(deadline);
            if (isNaN(deadlineDate.getTime())) return 'unknown';
            const diffDays = Math.ceil((deadlineDate - now) / (1000 * 60 * 60 * 24));
            if (diffDays < 0) return 'passed'; if (diffDays <= 7) return 'urgent'; if (diffDays <= 30) return 'warning'; return 'normal';
        }

        function formatDeadline(deadline) {
            if (!deadline || deadline === 'TBD') return '<span class="deadline-unknown">TBD</span>';
            const status = getDeadlineStatus(deadline);
            const date = new Date(deadline);
            if (isNaN(date.getTime())) return `<span class="deadline-unknown">${deadline}</span>`;
            const formattedDate = date.toLocaleDateString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit' });
            return `<span class="deadline-${status}">${formattedDate}</span>`;
        }
        
        async function fetchData(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return response;
            } catch (error) {
                console.error(`Failed to fetch ${url}:`, error);
                showStatus(`加载文件 ${url.split('/').pop()} 失败!`, 'error');
                return null;
            }
        }

        function processConfData(confYaml) { /* ... implementation unchanged ... */ }
        function processAccData(accYaml) { /* ... implementation unchanged ... */ }
        function getAcceptanceRate(title, year) { /* ... implementation unchanged ... */ }

        async function updateConferenceData() {
            const updateBtn = document.getElementById('update-btn');
            const btnText = updateBtn.querySelector('.btn-text');
            updateBtn.disabled = true; updateBtn.classList.add('loading'); btnText.textContent = '更新中...';
            showStatus('正在从GitHub获取最新会议数据...', 'info');

            const confResponse = await fetchData(`https://raw.githubusercontent.com/ccfddl/ccfddl.github.io/page/conference/allconf.yml?t=${Date.now()}`);
            const accResponse = await fetchData(`https://raw.githubusercontent.com/ccfddl/ccfddl.github.io/page/conference/allacc.yml?t=${Date.now()}`);

            if (!confResponse || !accResponse) {
                showStatus('网络数据获取失败，请稍后重试', 'error');
            } else {
                try {
                    const confYaml = await confResponse.text();
                    const accYaml = await accResponse.text();
                    
                    conferenceData = processConfData(confYaml);
                    acceptanceRateData = processAccData(accYaml);

                    conferenceData.forEach(conf => {
                        conf.acceptance_rate = getAcceptanceRate(conf.title, conf.year);
                    });

                    localStorage.setItem('conferenceData', JSON.stringify(conferenceData));
                    localStorage.setItem('acceptanceRateData', JSON.stringify(acceptanceRateData));
                    localStorage.setItem('lastUpdate', new Date().toISOString());

                    populateConferenceFilterOptions(conferenceData);
                    updateTable('ccf');
                    showStatus(`会议数据更新成功！共 ${conferenceData.length} 条记录`, 'success');
                } catch(e) {
                    showStatus('解析网络数据失败！', 'error');
                }
            }
            updateBtn.disabled = false; updateBtn.classList.remove('loading'); btnText.textContent = '更新会议数据';
        }

        // ... Other functions like parseMarkdown, parseExcel, populating filters, sorting, rendering ...
        // Note: I will copy these functions from your original code and add the necessary fixes.
        
        // --- DATA PROCESSING (FIXED) ---
        processConfData = (confYaml) => {
            try {
                const data = jsyaml.load(confYaml);
                const processed = [];
                data.forEach(conf => {
                    if (conf.confs && conf.confs.length > 0) {
                        conf.confs.forEach(c => {
                            processed.push({
                                title: conf.title, description: conf.description, sub: conf.sub,
                                ccf_rank: conf.rank?.ccf, // **FIXED**: Correctly get CCF Rank
                                year: c.year, deadline: c.timeline?.[0]?.deadline || 'TBD',
                                date: c.date, place: c.place, link: c.link,
                            });
                        });
                    }
                });
                return processed;
            } catch (e) { console.error('YAML conf parsing failed:', e); return []; }
        };

        processAccData = (accYaml) => {
            try {
                const data = jsyaml.load(accYaml);
                const accMap = {};
                data.forEach(item => { if (item.title && item.accept_rates) accMap[item.title] = item.accept_rates; });
                return accMap;
            } catch(e) { console.error('YAML acc parsing failed:', e); return {}; }
        };
        
        getAcceptanceRate = (title, year) => {
            const rates = acceptanceRateData[title];
            if (!rates) return null;
            // Safe check for year
            if (year == null) return rates.sort((a,b) => b.year - a.year)[0] || null;
            const exactMatch = rates.find(r => r.year != null && r.year.toString() === year.toString());
            if (exactMatch) return exactMatch;
            return rates.sort((a,b) => Math.abs(a.year - year) - Math.abs(b.year - year))[0] || null;
        };

        parseMarkdown = (markdownText) => {
            const lines = markdownText.split('\n');
            const data = [];
            let currentCategory = ''; let currentType = ''; let currentLevel = 'N';
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line.startsWith('#####')) {
                    if (line.startsWith('######')) {
                        const levelMatch = line.match(/(A|B|C)/); if (levelMatch) { currentLevel = levelMatch[1]; continue; }
                    }
                    const headingText = line.substring(5).trim();
                    const categoryMatch = headingText.match(/（(.*)）/); const typeMatch = headingText.match(/(期刊|会议)/);
                    if (categoryMatch) { currentCategory = categoryMatch[1].replace(/\*|/g, '').trim(); }
                    if (typeMatch) { currentType = typeMatch[1]; }
                    continue;
                }
                if (line.startsWith('|') && line.includes('|') && !line.includes('---') && !line.includes('序号')) {
                    const columns = line.split('|').map(col => col.trim());
                    if (columns.length > 4 && columns[2]) {
                        data.push({ category: currentCategory, type: currentType, level: currentLevel, name: columns[2], totalname: columns[3], publisher: columns[4], url: columns[5] });
                    }
                }
            }
            return data;
        };

        parseExcel = (buffer) => {
            const workbook = XLSX.read(buffer, { type: 'array' });
            const jcrJson = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
            const parsedJcrData = jcrJson.map(item => ({ name: item['期刊名'] || '', issn: item['ISSN'] || '', category: item['Category'] || '', impactFactor: parseFloat(item['2024JIF']) || 0, quartile: item['Quartile'] || '' }));

            const casJson = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[1]]);
            const casMap = new Map(casJson.map(item => [(item['期刊名称'] || '').toLowerCase().trim(), { cas_partition: `${item['2025分区']}区${item['Top'] === '是' ? ' Top' : ''}` }]));
            
            parsedJcrData.forEach(item => {
                const casInfo = casMap.get(item.name.toLowerCase().trim());
                item.cas_partition = casInfo ? casInfo.cas_partition : 'N/A';
            });
            return parsedJcrData;
        };
        
        // --- UI & Rendering (Your original functions with robustness fixes) ---
        populateConferenceFilterOptions = (data) => {
            const categories = [...new Set(data.map(item => item.sub).filter(Boolean))].sort();
            const years = [...new Set(data.map(item => item.year).filter(Boolean))].sort((a, b) => b - a);
            const categoryFilter = document.getElementById('category-filter');
            const yearFilter = document.getElementById('year-filter');
            categoryFilter.innerHTML = '<option value="all">所有领域</option>';
            yearFilter.innerHTML = '<option value="all">所有年份</option>';
            categories.forEach(c => { const opt = document.createElement('option'); opt.value = c; opt.textContent = categoryMap[c] || c; categoryFilter.appendChild(opt); });
            years.forEach(y => { const opt = document.createElement('option'); opt.value = y; opt.textContent = y; yearFilter.appendChild(opt); });
        };
        
        populateMarkdownFilterOptions = (data) => {
            const categories = [...new Set(data.map(item => item.category).filter(Boolean))];
            const types = [...new Set(data.map(item => item.type).filter(Boolean))];
            const publishers = [...new Set(data.map(item => item.publisher).filter(Boolean))];
            
            const catSelect = document.getElementById('markdown-category-filter'); catSelect.innerHTML = '<option value="all">所有领域</option>'; categories.forEach(c => catSelect.innerHTML += `<option value="${c}">${c}</option>`);
            const typeSelect = document.getElementById('markdown-type-filter'); typeSelect.innerHTML = '<option value="all">所有类型</option>'; types.forEach(t => typeSelect.innerHTML += `<option value="${t}">${t}</option>`);
            const pubSelect = document.getElementById('markdown-publisher-filter'); pubSelect.innerHTML = '<option value="all">所有出版社</option>'; publishers.forEach(p => pubSelect.innerHTML += `<option value="${p}">${p}</option>`);
        };

        populateJCRFilterOptions = (data) => {
            const categoryOptions = [...new Set(data.flatMap(item => (item.category || '').split(';')).filter(Boolean))];
            const categoryFilter = document.getElementById('jcr-category-filter');
            categoryOptions.forEach(c => categoryFilter.innerHTML += `<option value="${c}">${c}</option>`);
        };

        sortData = (data, column, direction) => {
            if (!column || direction === 'none') return data;
            return [...data].sort((a, b) => {
                let valA = a[column], valB = b[column];
                if (column === 'deadline') { const tA = new Date(valA).getTime(); const tB = new Date(valB).getTime(); valA = isNaN(tA) ? 0 : tA; valB = isNaN(tB) ? 0 : tB; } 
                else if (column === 'acceptance_rate') { valA = valA?.rate ?? -1; valB = valB?.rate ?? -1; } 
                else if (typeof valA === 'string') { valA = valA.toLowerCase(); valB = (valB || '').toLowerCase(); } 
                else { valA = valA || 0; valB = valB || 0; }
                if (valA < valB) return direction === 'asc' ? -1 : 1; if (valA > valB) return direction === 'asc' ? 1 : -1; return 0;
            });
        };

        handleSort = (column) => {
            const indicators = document.querySelectorAll('.sort-indicator'); indicators.forEach(i => { if (i.parentElement.dataset.column !== column) i.className = 'sort-indicator none'; });
            const currentIndicator = document.querySelector(`[data-column="${column}"] .sort-indicator`);
            if (sortState.column === column) { sortState.direction = sortState.direction === 'asc' ? 'desc' : (sortState.direction === 'desc' ? 'none' : 'asc'); } 
            else { sortState.column = column; sortState.direction = 'asc'; }
            if (currentIndicator) currentIndicator.className = `sort-indicator ${sortState.direction}`;
            updateTable(currentTab);
        };
        
        function updateTable(tab) {
            const tableHeader = document.getElementById('table-header');
            if (tab === 'ccf') tableHeader.innerHTML = ccfHeaderTemplate;
            else if (tab === 'jcr') tableHeader.innerHTML = jcrHeaderTemplate;
            else if (tab === 'markdown') tableHeader.innerHTML = markdownHeaderTemplate;
            document.querySelectorAll('.sortable-header').forEach(header => header.addEventListener('click', () => handleSort(header.dataset.column)));
            
            let dataToFilter = [];
            if (tab === 'ccf') dataToFilter = conferenceData;
            else if (tab === 'jcr') dataToFilter = jcrData;
            else if (tab === 'markdown') dataToFilter = markdownData;

            let filteredData = filterData(dataToFilter, tab);
            
            if (sortState.column && sortState.direction !== 'none') filteredData = sortData(filteredData, sortState.column, sortState.direction);

            const noResultsEl = document.getElementById('no-results');
            const paginationContainer = document.getElementById('pagination-container');
            if (filteredData.length === 0) { noResultsEl.style.display = 'block'; paginationContainer.innerHTML = ''; document.getElementById('table-body').innerHTML = ''; return; }
            noResultsEl.style.display = 'none';
            
            renderPagination(filteredData);
        }

        function filterData(data, tab) {
            const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
            if (tab === 'ccf') {
                const category = document.getElementById('category-filter').value; const level = document.getElementById('level-filter').value; const year = document.getElementById('year-filter').value; const deadline = document.getElementById('deadline-filter').value;
                return data.filter(item => (searchTerm === '' || (item.title||'').toLowerCase().includes(searchTerm) || (item.description||'').toLowerCase().includes(searchTerm)) && (category === 'all' || item.sub === category) && (level === 'all' || item.ccf_rank === level) && (year === 'all' || item.year?.toString() === year) && (deadline === 'all' || (deadline === 'upcoming' && getDeadlineStatus(item.deadline) === 'urgent') || (deadline === 'open' && ['normal', 'warning'].includes(getDeadlineStatus(item.deadline))) || (deadline === 'passed' && getDeadlineStatus(item.deadline) === 'passed')));
            }
            if (tab === 'jcr') {
                const category = document.getElementById('jcr-category-filter').value; const impact = document.getElementById('jcr-impact-filter').value; const quartile = document.getElementById('jcr-quartile-filter').value; const casPartition = document.getElementById('jcr-cas-filter').value;
                return data.filter(item => (searchTerm === '' || (item.name||'').toLowerCase().includes(searchTerm)) && (category === 'all' || (item.category||'').includes(category)) && (impact === 'all' || (impact === 'high' && item.impactFactor >= 10) || (impact === 'medium' && item.impactFactor >= 5 && item.impactFactor < 10) || (impact === 'low' && item.impactFactor < 5)) && (quartile === 'all' || item.quartile === quartile) && (casPartition === 'all' || (casPartition === 'Top' && (item.cas_partition || '').includes('Top')) || (casPartition !== 'Top' && (item.cas_partition || '').startsWith(casPartition))));
            }
            if (tab === 'markdown') {
                const category = document.getElementById('markdown-category-filter').value; const type = document.getElementById('markdown-type-filter').value; const level = document.getElementById('markdown-level-filter').value; const publisher = document.getElementById('markdown-publisher-filter').value;
                return data.filter(item => (searchTerm === '' || (item.name||'').toLowerCase().includes(searchTerm) || (item.totalname||'').toLowerCase().includes(searchTerm)) && (category === 'all' || item.category === category) && (type === 'all' || item.type === type) && (level === 'all' || item.level === level) && (publisher === 'all' || item.publisher === publisher));
            }
            return data;
        }

        function renderPagination(data) {
            const container = document.getElementById('pagination-container'); container.innerHTML = '';
            const itemsPerPage = 50; const totalPages = Math.ceil(data.length / itemsPerPage);
            if (totalPages <= 1) { renderPageData(data, 1, itemsPerPage); return; }
            let currentPage = 1;
            const renderButtons = () => {
                container.innerHTML = ''; const maxButtons = 5; let startPage = Math.max(1, currentPage - 2); let endPage = Math.min(totalPages, startPage + maxButtons - 1); if (endPage - startPage < maxButtons - 1) startPage = Math.max(1, endPage - maxButtons + 1);
                const createBtn = (text, page) => { const btn = document.createElement('button'); btn.className = 'pagination-btn'; btn.textContent = text; btn.onclick = () => { currentPage = page; renderButtons(); }; return btn; };
                if (currentPage > 1) container.appendChild(createBtn('<<', 1));
                for (let i = startPage; i <= endPage; i++) { const btn = createBtn(i, i); if (i === currentPage) btn.classList.add('active'); container.appendChild(btn); }
                if (currentPage < totalPages) container.appendChild(createBtn('>>', totalPages));
                renderPageData(data, currentPage, itemsPerPage);
            };
            renderButtons();
        }

        function escapeHtml(str) {
            // 只处理可能破坏属性的单引号，以保证data-info='...'的完整性
            return str.replace(/'/g, "&#39;");
        }

        // 分享函数添加
        function shareItem(button) {
            const item = JSON.parse(button.dataset.info);
            const type = button.dataset.type;
            let textToCopy = '';

            if (type === 'ccf') {

                const accRateText = item.acceptance_rate 
                    ? `${(item.acceptance_rate.rate * 100).toFixed(1)}%` 
                    : 'N/A';

                textToCopy = `【CCF会议推荐】\n- 简称: ${item.title}\n- 全称: ${item.description}\n- 级别: CCF ${item.ccf_rank}\n- 录用率: ${accRateText}\n- 截稿: ${item.deadline || 'TBD'}\n- 官网: ${item.link}`;
            } else if (type === 'jcr') {
                textToCopy = `【期刊推荐】\n- 期刊名: ${item.name}\n- 影响因子: ${item.impactFactor}\n- JCR分区: ${item.quartile}\n- 中科院分区: ${item.cas_partition}`;
            } else if (type === 'markdown') {
                textToCopy = `【CCF列表推荐】\n- 名称: ${item.name} (${item.totalname})\n- 类型: ${item.type}\n- 级别: ${item.level}\n- 出版社: ${item.publisher}`;
            }

            navigator.clipboard.writeText(textToCopy).then(() => {
                showStatus('条目信息已复制到剪贴板！', 'success');
                button.textContent = '已复制!';
                button.classList.add('copied');
                setTimeout(() => {
                    button.textContent = '分享';
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                showStatus('复制失败，请检查浏览器权限。', 'error');
            });
        }

        function renderPageData(data, page, pageSize) {
            const tableBody = document.getElementById('table-body'); tableBody.innerHTML = '';
            const pageData = data.slice((page - 1) * pageSize, page * pageSize);
            pageData.forEach(item => {
                const row = document.createElement('tr');
                if (currentTab === 'ccf') {
                    const accRateHtml = item.acceptance_rate ? `<span title="${item.acceptance_rate.str || ''}">${(item.acceptance_rate.rate * 100).toFixed(1)}%</span>` : '<span class="text-muted">N/A</span>';
                    // CCF行渲染修改
                    row.innerHTML = `<td data-label="简称">${item.title}</td><td data-label="全称">${item.description}</td><td data-label="领域">${categoryMap[item.sub] || item.sub}</td><td data-label="CCF">${item.ccf_rank || 'N/A'}</td><td data-label="年份">${item.year}</td><td data-label="截稿时间">${formatDeadline(item.deadline)}</td><td data-label="录用率">${accRateHtml}</td><td data-label="会议日期">${item.date || 'N/A'}</td><td data-label="地点">${item.place || 'N/A'}</td><td data-label="链接"><a href="${item.link}" target="_blank">访问</a></td><td data-label="分享"><button class="share-row-btn" data-type="ccf" data-info='${escapeHtml(JSON.stringify(item))}' onclick="shareItem(this)">分享</button></td>`;
                } else if (currentTab === 'jcr') {
                    // JCR行渲染修改
                    row.innerHTML = `<td data-label="期刊名">${item.name}</td><td data-label="ISSN">${item.issn}</td><td data-label="类别">${item.category}</td><td data-label="影响因子">${item.impactFactor}</td><td data-label="JCR分区">${item.quartile}</td><td data-label="中科院分区">${item.cas_partition}</td><td data-label="分享"><button class="share-row-btn" data-type="jcr" data-info='${JSON.stringify(item)}' onclick="shareItem(this)">分享</button></td>`;
                } else {
                    // Markdown行渲染修改
                    row.innerHTML = `<td data-label="简称">${item.name}</td><td data-label="全称">${item.totalname}</td><td data-label="领域">${item.category}</td><td data-label="类型">${item.type}</td><td data-label="级别">${item.level}</td><td data-label="出版社">${item.publisher}</td><td data-label="链接">${item.url}</td><td data-label="分享"><button class="share-row-btn" data-type="markdown" data-info='${JSON.stringify(item)}' onclick="shareItem(this)">分享</button></td>`;
                }
                tableBody.appendChild(row);
            });
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            if (window.location.protocol === 'file:') {
                showStatus('错误: 请使用本地Web服务器 (如 VS Code 的 Live Server) 打开此文件，否则无法加载数据。', 'error');
                return;
            }

            showStatus('正在加载数据，请稍候...', 'info');
            
            const cachedConf = localStorage.getItem('conferenceData');
            const cachedAcc = localStorage.getItem('acceptanceRateData');
            if (cachedConf && cachedAcc) {
                conferenceData = JSON.parse(cachedConf);
                acceptanceRateData = JSON.parse(cachedAcc);
                showStatus('使用缓存数据加载成功', 'success');
            } else {
                await updateConferenceData();
            }
            populateConferenceFilterOptions(conferenceData);

            const mdResponse = await fetchData('index.md');
            if (mdResponse) { markdownData = parseMarkdown(await mdResponse.text()); populateMarkdownFilterOptions(markdownData); }

            const jcrResponse = await fetchData('jcr.xlsx');
            if (jcrResponse) { jcrData = parseExcel(await jcrResponse.arrayBuffer()); populateJCRFilterOptions(jcrData); }
            
            updateTable('ccf');

            document.querySelectorAll('.tab-btn').forEach(button => button.addEventListener('click', function() {
                currentTab = this.dataset.tab;
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active')); this.classList.add('active');
                document.getElementById('ccf-filters').style.display = currentTab === 'ccf' ? 'block' : 'none';
                document.getElementById('jcr-filters').style.display = currentTab === 'jcr' ? 'block' : 'none';
                document.getElementById('markdown-filters').style.display = currentTab === 'markdown' ? 'block' : 'none';
                sortState = { column: null, direction: 'none' }; updateTable(currentTab);
            }));
            
            document.getElementById('reset-btn').addEventListener('click', function() { document.getElementById('search-input').value = ''; document.querySelectorAll('select').forEach(s => s.value = 'all'); sortState = { column: null, direction: 'none' }; updateTable(currentTab); });
            document.getElementById('dark-mode-btn').addEventListener('click', function() { document.body.classList.toggle('dark-mode'); this.textContent = document.body.classList.contains('dark-mode') ? '日间模式' : '夜间模式'; });
            document.getElementById('update-btn').addEventListener('click', updateConferenceData);
            document.getElementById('share-btn').addEventListener('click', function() {
                navigator.clipboard.writeText(window.location.href).then(() => {
                    showStatus('页面链接已复制到剪贴板！', 'success');
                }).catch(err => {
                    showStatus('复制失败，请手动复制链接。', 'error');
                    console.error('Failed to copy: ', err);
                });
            });
            document.getElementById('search-input').addEventListener('input', () => updateTable(currentTab));
            document.querySelectorAll('.filter-container select, .jcr-filter-container select, .markdown-filter-container select').forEach(s => s.addEventListener('change', () => updateTable(currentTab)));
        });
    </script>
</body>
</html>